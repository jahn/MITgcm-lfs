before starting, on alhena use:

source /opt/modules/modules/init/tcsh
module load modules
module load MIPSpro.73

===================================================================

explicit paths in coupled model is in:
./include/UserOptions.h
#define ESM_INPUT_FILE "/u/menemenl/camel_7.2p/bin/esm_input"

then:
 cd ./esm/service
 make

also in ./bin/esminput
 FE_datdir='/nobackup2/menemenl/coupled2/data',
 FE_mssdir='/nobackup2/menemenl/coupled2/data',

and in cshrc.setup
setenv CAMILLEHOME /nobackup2/menemenl/coupled2/camel_7.2p

===================================================================

esm_input : 16 4  -> atmospheric CPUs + 1; oceanic CPUs

esminput:

 tbegin=1835.0,   -> time in days from 0000 (Jan. 10, 0005 00:00 GMT)
 tfinal=10601.0,  -> 10-year integration
 GM_run=0,        -> no AGCM output to FE_datdir
 GM_run=1,        -> allow AGCM output to FE_datdir
 OD_dtom=6.0,     -> coupling interval in hours

 NP_agcm=6,       -> total # of atmospheric CPUs
 NPI_agcm=2,      -> x-direction CPUS, better if rather small
 NPJ_agcm=3,      -> y-direction CPUS
 dt_agcmhist_out=5184000.0, -> atmosphere model checkpointing in seconds

===================================================================

 C   8 Calling G2OEIU  timestamp= 18:16:46                        44046.00
 C   1 Calling G2OEIU  timestamp= 18:16:50                        44049.00
 C   1 Exiting G2OEIU  timestamp= 18:16:50                            0
 C   8 Exiting G2OEIU  timestamp= 18:16:50                            0
 C   8 Calling O2GEIU  timestamp= 18:16:58                        44049.00
 C   8 Exiting O2GEIU  timestamp= 18:16:58            
 C   1 Calling O2GEIU  timestamp= 18:16:58                        44052.00
 C   1 Exiting O2GEIU  timestamp= 18:16:58            

Note, G2OEIU means AGCM to OGCM.  O2GEIU means OGCM to AGCM.  This particular
example, a 7-CPU atmosphere and a 56-CPU ocean, shows that the ocean model,
process 8, needs to wait for 4 seconds for the atmosphere model, process 1, to
provide it with data.  While the atmosphere model receives data right away
from the ocean.  So the atmosphere is slower than the ocean and needs to
allocated more CPUs.

===================================================================

This is a 4-CPU experiment, which is based on global_ocean.90x40x15.

Instructions for running verification/coupled_ucla:
  cd MITgcm/bin
  cp ../verification/coupled_ucla/code/*.h .
  ../tools/genmake -mpi -makefile
    ==> on alhena use:
      ../tools/genmake -mpi -platform=o2k -makefile
    ==> on turing use:
      ../tools/genmake -mpi -platform=ames_dbg -makefile
  make depend
  make
  cd ../exe
  cp -f ../verification/coupled_ucla/input/* .
  ln -sf data.coupled_debug data
  ln -sf data.pkg.nokpp data.pkg
  ln -sf data.gmredi.gkw91 data.gmredi
  ln -sf POLY3.COEFFS.15 POLY3.COEFFS
  mpirun -np 4 mitgcmuv

Comparison output:
  cmp Eta.*10.data ../verification/coupled_ucla/results/Eta.*

===================================================================

Instructions for creating library for 4x4, 4cpu ocean model:
  cd MITgcm/bin
  cp ../verification/coupled_ucla/code/SIZE.h .
  cp ../verification/coupled_ucla/code/GMREDI_OPTIONS.h .
  cp ../verification/coupled_ucla/code/CPP_EEOPTIONS.h .
  cp ../verification/coupled_ucla/code/CPP_OPTIONS.h.coupled_nokpp CPP_OPTIONS.h
  ../tools/genmake -mpi -makefile
==> on alhena and turing use:
  ../tools/genmake -mpi -platform=ames_opt -makefile
  make depend
  make
  rm -f libocean.a
  ar r libocean.a *.o
  chmod 644 libocean.a
==> then copy or link libocean.a to camel_7.2p/esm/lib
==> go to camel_7.2p directory
  cd camel_7.2p
  source cshrc.setup
  make link
  cd bin
==> copy release1_coupled/verification/coupled_ucla/input/* to camel_7.2p/bin
  ln -sf data.coupled_90x40 data
  ln -sf data.pkg.nokpp data.pkg
  ln -sf data.gmredi.gkw91 data.gmredi
  ln -sf POLY3.COEFFS.15 POLY3.COEFFS
  rm -f output.txt STD*
  
  mpirun -np 20 camel2 >& output.txt


===================================================================

Instructions for creating library for JPL-ECCO-1/3-deg, 64cpu ocean model:
  cd MITgcm/bin
  cp ../verification/coupled_ucla/code/SIZE.h.64 SIZE.h
  cp ../verification/coupled_ucla/code/GMREDI_OPTIONS.h .
  cp ../verification/coupled_ucla/code/CPP_EEOPTIONS.h .
  cp ../verification/coupled_ucla/code/CPP_OPTIONS.h.coupled_kpp CPP_OPTIONS.h
  ../tools/genmake -mpi -makefile
==> on alhena and turing use:
  ../tools/genmake -mpi -platform=ames_opt -makefile
  make depend
  make
  rm -f libocean.a
  ar r libocean.a *.o
  chmod 644 libocean.a
==> then copy or link libocean.a to camel_7.2p/esm/lib
==> go to camel_7.2p directory
  cd camel_7.2p
  source cshrc.setup
  make link
  cd bin
==> copy release1_coupled/verification/coupled_ucla/input/* to camel_7.2p/bin
  ln -sf data.coupled_360x224 data
  ln -sf data.pkg.kpp data.pkg
  ln -sf data.gmredi.ldd97 data.gmredi
  ln -sf POLY3.COEFFS.46 POLY3.COEFFS
  rm -f output.txt STD*
  mpirun -np 80 camel2 >& output.txt


===================================================================

Hi-res ocean, low-res atmosphere on 64-CPU:
Note that with 1-hour time steps, ocean model fails after 35 days.

  ssh gemini.jpl.nasa.gov
  cd /tmp1/dmenem
  mkdir oldpbl
  cd oldpbl
  dmget /silo/dmenem/coupled/camel_7.2p_042903.tar
  tar xvf /silo/dmenem/coupled/camel_7.2p_042903.tar
  mitcvs co -r release1_coupled MITgcm
  cd MITgcm/bin
  cp ../verification/coupled_ucla/code/SIZE.h.56 SIZE.h
  cp ../verification/coupled_ucla/code/GMREDI_OPTIONS.h .
  cp ../verification/coupled_ucla/code/CPP_EEOPTIONS.h .
  cp ../verification/coupled_ucla/code/CPP_OPTIONS.h.coupled_kpp CPP_OPTIONS.h
  ../tools/genmake -mpi -platform=ames_opt -makefile
  make depend
  make
  rm -f libocean.a
  ar r libocean.a *.o
  chmod 644 libocean.a
  cp libocean.a ../../camel_7.2p_042903/esm/lib/
  cd ../../camel_7.2p_042903
  cp ../MITgcm/verification/coupled_ucla/input/UserOptions.h include
  cp ../MITgcm/verification/coupled_ucla/input/cshrc.setup .
  source cshrc.setup
  make clean
  make
  cd bin
  cp ../../MITgcm/verification/coupled_ucla/input/* .
  cp data.coupled_360x224 data
  cp data.pkg.kpp data.pkg
  cp data.gmredi.ldd97 data.gmredi
  cp POLY3.COEFFS.46 POLY3.COEFFS
  cp esm_input.56 esm_input
  cp esminput.56 esminput

Submitting a job on alhena:

  cd /alhena/tmp1/dmenem
  mv oldpbl recycle_bin
  mkdir oldpbl
  cd oldpbl
  mkdir data
  mkdir camel_7.2p_042903
  cd camel_7.2p_042903
  cp -r /tmp1/dmenem/oldpbl/camel_7.2p_042903/bin .
  cd bin
  qsub submit.long64a

Submitting a job on castor:

  cd /castor/tmp1/dmenem
  mv oldpbl recycle_bin
  mkdir oldpbl
  cd oldpbl
  mkdir data
  mkdir camel_7.2p_042903
  cd camel_7.2p_042903
  cp -r /tmp1/dmenem/oldpbl/camel_7.2p_042903/bin .
  cd bin
  qsub submit.long64c

Submitting a job on pollux:

  cd /pollux/tmp1/dmenem
  mv oldpbl recycle_bin
  mkdir oldpbl
  cd oldpbl
  mkdir data
  mkdir camel_7.2p_042903
  cd camel_7.2p_042903
  cp -r /tmp1/dmenem/oldpbl/camel_7.2p_042903/bin .
  cd bin
  qsub submit.long64p
